<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#F5F5F7">
    <title>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå - MK Vocab</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../css/style.css">
</head>

<body>
    <div class="container">
        <div id="app-content">
            <div style="text-align: center; padding: 100px 20px;">
                <div style="font-size: 48px; margin-bottom: 16px;">üìö</div>
                <div style="color: var(--text-secondary);">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>
            </div>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav">
        <div class="bottom-nav-container">
            <a href="../index.html" class="nav-item">
                <svg viewBox="0 0 24 24" fill="currentColor">
                    <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z" />
                </svg>
                <span>‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</span>
            </a>
            <a href="vocab-list.html" class="nav-item active">
                <svg viewBox="0 0 24 24" fill="currentColor">
                    <path
                        d="M18 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM6 4h5v8l-2.5-1.5L6 12V4z" />
                </svg>
                <span>‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå</span>
            </a>
            <a href="games.html" class="nav-item">
                <svg viewBox="0 0 24 24" fill="currentColor">
                    <path
                        d="M21.58 16.09l-1.09-7.66C20.21 6.46 18.52 5 16.53 5H7.47C5.48 5 3.79 6.46 3.51 8.43l-1.09 7.66C2.2 17.63 3.39 19 4.94 19c.68 0 1.32-.27 1.8-.75L9 16h6l2.25 2.25c.48.48 1.13.75 1.8.75 1.56 0 2.75-1.37 2.53-2.91zM11 11H9v2H8v-2H6v-1h2V8h1v2h2v1zm4-1c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1zm2 3c-.55 0-1-.45-1-1s.45-1 1-1 1 .45 1 1-.45 1-1 1z" />
                </svg>
                <span>‡πÄ‡∏Å‡∏°</span>
            </a>
            <a href="stats.html" class="nav-item">
                <svg viewBox="0 0 24 24" fill="currentColor">
                    <path
                        d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z" />
                </svg>
                <span>‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥</span>
            </a>
            <a href="settings.html" class="nav-item">
                <svg viewBox="0 0 24 24" fill="currentColor">
                    <path
                        d="M19.14 12.94c.04-.31.06-.63.06-.94 0-.31-.02-.63-.06-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z" />
                </svg>
                <span>‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</span>
            </a>
        </div>
    </nav>

    <script src="../js/storage.js"></script>
    <script src="../js/speech.js"></script>
    <script>
        // Vocab List Page
        const VocabList = {
            grade: 'm1',
            words: [],
            filteredWords: [],

            grades: {
                m1: { name: '‡∏°.1', color: 'grade-m1' },
                m2: { name: '‡∏°.2', color: 'grade-m2' },
                m3: { name: '‡∏°.3', color: 'grade-m3' },
                m4: { name: '‡∏°.4', color: 'grade-m4' },
                m5: { name: '‡∏°.5', color: 'grade-m5' },
                m6: { name: '‡∏°.6', color: 'grade-m6' }
            },

            async init() {
                // Get grade from URL
                const params = new URLSearchParams(window.location.search);
                this.grade = params.get('grade') || 'm1';

                // Load data
                await this.loadData();
                this.render();
                this.setupSearch();
                this.setupDarkMode();
            },

            async loadData() {
                try {
                    const response = await fetch(`../data/${this.grade}.json`);
                    const data = await response.json();
                    this.words = data.words || [];
                    this.filteredWords = [...this.words];
                } catch (error) {
                    console.error('Error loading vocab data:', error);
                    this.words = [];
                    this.filteredWords = [];
                }
            },

            render() {
                const gradeInfo = this.grades[this.grade];
                const learnedCount = Storage.getLearned(this.grade).length;

                let html = `
                    <div class="header fade-in">
                        <a href="../index.html" style="color: var(--apple-blue); text-decoration: none; font-size: 14px; display: inline-flex; align-items: center; gap: 4px; margin-bottom: 8px;">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
                            </svg>
                            ‡∏Å‡∏•‡∏±‡∏ö
                        </a>
                        <h1 class="header-title">‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå ${gradeInfo.name}</h1>
                        <p class="header-subtitle">${learnedCount}/${this.words.length} ‡∏Ñ‡∏≥‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡πâ‡∏ß</p>
                    </div>

                    <div class="section fade-in" style="animation-delay: 0.1s">
                        <div class="search-wrapper">
                            <svg viewBox="0 0 24 24" fill="currentColor">
                                <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
                            </svg>
                            <input type="text" id="search-input" class="search-input" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå...">
                        </div>
                    </div>

                    <!-- Grade Tabs -->
                    <div class="section fade-in" style="animation-delay: 0.15s">
                        <div style="display: flex; gap: 8px; overflow-x: auto; padding-bottom: 8px;">
                            ${Object.entries(this.grades).map(([key, info]) => `
                                <a href="?grade=${key}" class="btn ${key === this.grade ? 'btn-primary' : 'btn-secondary'}" style="white-space: nowrap; padding: 10px 16px; font-size: 14px;">
                                    ${info.name}
                                </a>
                            `).join('')}
                        </div>
                    </div>

                    <div class="section fade-in" style="animation-delay: 0.2s">
                        <div style="display: flex; gap: 8px; margin-bottom: 16px;">
                            <a href="flashcard.html?grade=${this.grade}" class="btn btn-primary" style="flex: 1;">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/>
                                </svg>
                                Flashcard
                            </a>
                        </div>
                    </div>

                    <div class="section" id="vocab-list">
                        ${this.renderVocabItems()}
                    </div>
                `;

                document.getElementById('app-content').innerHTML = html;
            },

            renderVocabItems() {
                if (this.filteredWords.length === 0) {
                    return `
                        <div style="text-align: center; padding: 40px 20px; color: var(--text-secondary);">
                            <div style="font-size: 48px; margin-bottom: 16px;">üîç</div>
                            <div>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå</div>
                        </div>
                    `;
                }

                return this.filteredWords.map((word, index) => {
                    const isLearned = Storage.isLearned(this.grade, word.id);
                    const isFavorite = Storage.isFavorite(this.grade, word.id);

                    return `
                        <div class="vocab-item fade-in" style="animation-delay: ${0.02 * Math.min(index, 20)}s" onclick="VocabList.goToDetail(${word.id})">
                            <div style="flex: 1;">
                                <div style="display: flex; align-items: center; gap: 8px;">
                                    <span style="font-size: 18px; font-weight: 600;">${word.word}</span>
                                    <span class="cefr-badge cefr-${word.cefr.toLowerCase()}">${word.cefr}</span>
                                    ${isLearned ? '<span style="color: var(--apple-green);">‚úì</span>' : ''}
                                </div>
                                <div style="font-size: 13px; color: var(--text-secondary); margin-top: 2px;">${word.partOfSpeech}</div>
                                <div style="font-size: 15px; margin-top: 4px;">${word.thai}</div>
                            </div>
                            <button class="btn btn-icon btn-secondary" onclick="event.stopPropagation(); VocabList.speak('${word.word.replace(/'/g, "\\'")}')">
                                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/>
                                </svg>
                            </button>
                        </div>
                    `;
                }).join('');
            },

            setupSearch() {
                const input = document.getElementById('search-input');
                if (input) {
                    input.addEventListener('input', (e) => {
                        const query = e.target.value.toLowerCase().trim();
                        if (query === '') {
                            this.filteredWords = [...this.words];
                        } else {
                            this.filteredWords = this.words.filter(w =>
                                w.word.toLowerCase().includes(query) ||
                                w.thai.includes(query)
                            );
                        }
                        document.getElementById('vocab-list').innerHTML = this.renderVocabItems();
                    });
                }
            },

            speak(word) {
                Speech.speak(word);
            },

            goToDetail(wordId) {
                window.location.href = `vocab-detail.html?grade=${this.grade}&id=${wordId}`;
            },

            setupDarkMode() {
                const settings = Storage.getSettings();
                if (settings.darkMode) {
                    document.body.classList.add('dark');
                }
            }
        };

        document.addEventListener('DOMContentLoaded', () => {
            VocabList.init();
        });
    </script>
</body>

</html>